var h=Object.defineProperty;var p=(s,t,e)=>t in s?h(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var r=(s,t,e)=>p(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();let g={windows:0,mac:0,linux:0,android:0,ios:0,total:0,lastUpdated:new Date().toISOString()},w={windows:0,mac:0,linux:0,android:0,ios:0,total:0,lastUpdated:new Date().toISOString()};class S{constructor(t,e){r(this,"stats");r(this,"persistent");r(this,"updateInterval",null);r(this,"listeners",[]);r(this,"autoIncrementEnabled",!1);this.stats={...t},this.persistent={...e},this.calculateTotal()}addListener(t){this.listeners.push(t)}notifyListeners(){const t=this.getCombinedStats();this.listeners.forEach(e=>e({...t}))}calculateTotal(){this.stats.total=this.stats.windows+this.stats.mac+this.stats.linux+this.stats.android+this.stats.ios,this.stats.lastUpdated=new Date().toISOString(),this.persistent.total=this.persistent.windows+this.persistent.mac+this.persistent.linux+this.persistent.android+this.persistent.ios,this.persistent.lastUpdated=new Date().toISOString()}getCombinedStats(){return{windows:this.stats.windows+this.persistent.windows,mac:this.stats.mac+this.persistent.mac,linux:this.stats.linux+this.persistent.linux,android:this.stats.android+this.persistent.android,ios:this.stats.ios+this.persistent.ios,total:this.stats.total+this.persistent.total,lastUpdated:new Date().toISOString()}}incrementDownload(t){this.persistent[t]++,this.calculateTotal(),this.notifyListeners(),this.animateCountUpdate(t),console.log(`Persistent download recorded for ${t}:`,this.persistent[t])}simulateDownload(){if(!this.autoIncrementEnabled)return;const t=["windows","mac","linux","android","ios"],e=t[Math.floor(Math.random()*t.length)],a=Math.floor(Math.random()*3)+1;for(let n=0;n<a;n++)this.stats[e]++;this.calculateTotal(),this.notifyListeners(),this.animateCountUpdate(e)}setAutoIncrement(t){this.autoIncrementEnabled=t,console.log(`Auto-increment ${t?"enabled":"disabled"}`)}isAutoIncrementEnabled(){return this.autoIncrementEnabled}startRealTimeUpdates(t=5e3){this.updateInterval&&clearTimeout(this.updateInterval);const e=()=>{this.simulateDownload(),this.updateInterval=setTimeout(e,t)};this.updateInterval=setTimeout(e,t)}stopRealTimeUpdates(){this.updateInterval&&(clearTimeout(this.updateInterval),this.updateInterval=null)}getStats(){return{...this.getCombinedStats()}}getPersistentStats(){return{...this.persistent}}getSimulatedStats(){return{...this.stats}}resetSimulatedStats(){this.stats={windows:0,mac:0,linux:0,android:0,ios:0,total:0,lastUpdated:new Date().toISOString()},this.calculateTotal(),this.notifyListeners()}animateCountUpdate(t){if(typeof document<"u"){const e=document.getElementById(`count-${t}`),a=document.getElementById("total-downloads");e&&(e.classList.add("count-update"),setTimeout(()=>e.classList.remove("count-update"),500)),a&&(a.classList.add("count-update"),setTimeout(()=>a.classList.remove("count-update"),500))}}exportJSON(){return JSON.stringify({combined:this.getCombinedStats(),persistent:this.persistent,simulated:this.stats},null,2)}loadFromJSON(t){try{const e=JSON.parse(t);return e.persistent&&(this.persistent={...e.persistent}),e.simulated&&(this.stats={...e.simulated}),this.calculateTotal(),this.notifyListeners(),!0}catch(e){return console.error("Error loading stats from JSON:",e),!1}}}const i=new S(g,w);function c(s){i.incrementDownload(s)}function m(){return i.getStats()}function I(){return i.getPersistentStats()}function b(){return i.getSimulatedStats()}function y(s){i.startRealTimeUpdates(s)}function L(){i.stopRealTimeUpdates()}function E(){i.resetSimulatedStats()}function O(s){i.addListener(s)}function f(){return i.exportJSON()}function D(s){return i.loadFromJSON(s)}function T(){i.setAutoIncrement(!0)}function x(){i.setAutoIncrement(!1)}function v(){return i.isAutoIncrementEnabled()}function l(s){if(typeof document>"u")return;["windows","mac","linux","android","ios"].forEach(n=>{const o=document.getElementById(`count-${n}`);o&&(o.textContent=s[n].toLocaleString())});const e=document.getElementById("total-downloads");e&&(e.textContent=s.total.toLocaleString());const a=document.getElementById("debug-json");a&&(a.textContent=i.exportJSON())}function U(){if(typeof document>"u")return;["windows","mac","linux","android","ios"].forEach(t=>{const e=document.getElementById(`download-stats-${t}`);e&&e.addEventListener("click",a=>{a.preventDefault(),c(t);const n=e,o=n.textContent;n.textContent="Downloaded!",n.classList.add("bg-green-600"),n.classList.remove("bg-indigo-600","hover:bg-indigo-700"),setTimeout(()=>{n.textContent=o||"Download",n.classList.remove("bg-green-600"),n.classList.add("bg-indigo-600","hover:bg-indigo-700")},1e3)})})}function u(){typeof document>"u"||(O(l),U(),l(m()),console.log("Download Stats Manager initialized"),console.log("Initial stats:",f()),console.log("NOTE: Auto-increment is DISABLED by default"),console.log("Only user clicks will increment download counts"),console.log("To enable auto-increment, call enableAutoIncrement() and startRealTimeUpdates()"))}typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u());typeof window<"u"&&(window.downloadStatsManager=i,window.downloadStatsAPI={incrementDownload:c,fetchDownloadStats:m,fetchPersistentDownloadStats:I,fetchSimulatedDownloadStats:b,startRealTimeUpdates:y,stopRealTimeUpdates:L,resetSimulatedStats:E,exportStatsJSON:f,loadStatsFromJSON:D,enableAutoIncrement:T,disableAutoIncrement:x,isAutoIncrementEnabled:v});
